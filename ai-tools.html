<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AI Tools Hub – RootBro</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- 全站样式 -->
<link rel="stylesheet" href="/assets/style.css">

<style>
/* --------------------------------------------------------
   RootBro Light & Relaxed UI Enhancements
--------------------------------------------------------- */

/* 全局调整 – 更松的间距 */
body {
  background: #ffffff;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  color: #222;
}

/* Hero 更轻松 */
.hero-small {
  max-width: 1080px;
  margin: 40px auto 20px;
  padding: 22px 20px;
  border-radius: 18px;
  background: linear-gradient(135deg, #0f6fff, #4b9dff);
  color: white;
}

.hero-small h1 {
  font-size: 24px;
  margin-bottom: 4px;
}

.hero-small p {
  font-size: 14px;
  opacity: 0.9;
}

/* 状态条 – 更轻、更薄 */
.engine-status {
  max-width: 1080px;
  margin: 16px auto;
  padding: 8px 14px;
  background: #e9f1ff;
  border-radius: 12px;
  font-size: 14px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.engine-status small {
  opacity: 0.7;
}

/* 工具网格 – 增大间距 16 → 26 */
.tools-grid {
  max-width: 1080px;
  margin: 26px auto 50px;
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(290px, 1fr));
  gap: 26px;
}

/* 单个工具卡片 – 更柔、更空 */
.tool-card {
  background: white;
  border-radius: 20px;
  padding: 20px 20px 18px;
  box-shadow: 0 2px 8px rgba(20, 30, 50, 0.06);
  display: flex;
  flex-direction: column;
}

.tool-card h3 {
  font-size: 17px;
  margin-bottom: 6px;
}

.tool-card p {
  font-size: 14px;
  color: #555;
  margin-bottom: 10px;
}

/* 文本区域 – 更柔、更轻 */
.tool-input,
.tool-output {
  width: 100%;
  min-height: 90px;
  padding: 10px 12px;
  font-size: 14px;
  border-radius: 12px;
  border: 1px solid #dde3ee;
  resize: vertical;
  margin-bottom: 8px;
  box-sizing: border-box;
  background: #ffffff;
}

/* 按钮 – 更圆润、更轻 */
.btn-primary {
  background: #0f6fff;
  color: white;
  padding: 8px 14px;
  font-size: 13px;
  border-radius: 14px;
  border: none;
  cursor: pointer;
}

.btn-secondary {
  background: #e9f1ff;
  color: #2750a8;
  padding: 8px 14px;
  font-size: 13px;
  border-radius: 14px;
  border: none;
  cursor: pointer;
}

/* -------------------------------------------------------------------
   Loading Modal（RootBro 蓝主题，轻松版）
-------------------------------------------------------------------- */

#loadingModal {
  position: fixed;
  inset: 0;
  background: rgba(15, 111, 255, 0.25); /* 半透明 RootBro 蓝 */
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 9999;
}

#loadingModal .modal-box {
  width: 90%;
  max-width: 380px;
  background: white;
  border-radius: 20px;
  padding: 24px 22px;
  box-shadow: 0 6px 18px rgba(15, 25, 40, 0.12);
  text-align: center;
}

#loadingModal h2 {
  font-size: 17px;
  margin-bottom: 10px;
  color: #0f6fff;
}

#loadingModal p {
  font-size: 13px;
  color: #444;
  margin-bottom: 16px;
  line-height: 1.5;
}

/* 进度条 */
.progress-bar {
  width: 100%;
  height: 6px;
  background: #e8f1ff;
  border-radius: 20px;
  overflow: hidden;
  margin-bottom: 10px;
}
.progress-bar-inner {
  height: 100%;
  background: #0f6fff;
  width: 0%;
  transition: width 0.2s ease;
}

/* Tooltip */
.info-tooltip {
  font-size: 12px;
  cursor: pointer;
  margin-left: 6px;
  opacity: 0.6;
}
.info-tooltip:hover {
  opacity: 1;
}

/* Tooltip box */
.tooltip-box {
  display: none;
  position: absolute;
  background: white;
  border: 1px solid #ddd;
  padding: 10px 12px;
  border-radius: 12px;
  font-size: 13px;
  width: 260px;
  box-shadow: 0 2px 8px rgba(50, 50, 80, 0.15);
}

</style>

</head>
<body>

<!-- Header ----------------------------------------------------------->
<header>
  <div class="logo">
    <a href="/"><img src="/assets/rootbro-logo.svg" height="32" alt="RootBro"></a>
  </div>
  <nav>
    <a href="/ai-draft">AI Draft</a>
    <a href="docs-ai">Docs AI</a>
    <a href="/ai-tools" class="active">AI Tools</a>
  </nav>
</header>

<!-- Hero ------------------------------------------------------------->
<section class="hero-small">
  <h1>RootBro AI Tools Hub</h1>
  <p>Lightweight, browser-based AI tools powered by Phi + WebLLM. No keys. No servers. Just write.</p>
</section>

<!-- 状态条 ------------------------------------------------------------>
<div class="engine-status">
  <div>Model: <strong>Phi mini (WebLLM)</strong></div>
  <div>Status: <span class="progress">Idle</span></div>
  <span class="info-tooltip" id="infoTip">ⓘ</span>
</div>

<!-- Tooltip 内容 -->
<div class="tooltip-box" id="tipBox">
  <strong>About model caching</strong><br><br>
  • The AI model is stored in your browser cache.<br>
  • The first load takes 10–25 seconds.<br>
  • After that, tools run instantly — even offline.<br><br>
  • The model reloads only if:<br>
   – You clear browser cache<br>
   – You switch browsers<br>
   – You use private mode
</div>

<!-- 工具卡片网格 ------------------------------------------------------>
<section>
  <h2 style="max-width:1080px;margin:10px auto 0;font-size:18px;">AI Writing Helpers</h2>

  <div class="tools-grid">

    <div class="tool-card">
      <h3>AI Summarizer</h3>
      <p>Create clear summaries (3–7 bullets or a short paragraph).</p>
      <textarea id="sumInput" class="tool-input" placeholder="Paste text…"></textarea>
      <button class="btn-primary" data-tool="summarize">Summarize</button>
      <textarea id="sumOutput" class="tool-output" placeholder="Summary appears here…"></textarea>
    </div>

    <div class="tool-card">
      <h3>AI Paraphraser</h3>
      <p>Rewrite text to be clearer and more natural.</p>
      <textarea id="paraInput" class="tool-input" placeholder="Paste text…"></textarea>
      <button class="btn-primary" data-tool="paraphrase">Paraphrase</button>
      <textarea id="paraOutput" class="tool-output" placeholder="Rewritten text appears here…"></textarea>
    </div>

    <div class="tool-card">
      <h3>AI Translate (EN ⇄ 中文)</h3>
      <p>Auto-detect and translate between English & Simplified Chinese.</p>
      <textarea id="transInput" class="tool-input" placeholder="English or 中文…"></textarea>
      <button class="btn-primary" data-tool="translate">Translate</button>
      <textarea id="transOutput" class="tool-output" placeholder="Translation appears here…"></textarea>
    </div>

    <div class="tool-card">
      <h3>AI Explain / Simplify</h3>
      <p>Explain complex text in simpler language.</p>
      <textarea id="explainInput" class="tool-input" placeholder="Complex text…"></textarea>
      <button class="btn-primary" data-tool="explain">Explain</button>
      <textarea id="explainOutput" class="tool-output" placeholder="Explanation appears here…"></textarea>
    </div>

    <div class="tool-card">
      <h3>AI Q&A</h3>
      <p>Ask a question about the text you provide.</p>
      <textarea id="qaInput" class="tool-input" placeholder="Context + your question…"></textarea>
      <button class="btn-primary" data-tool="qa">Answer</button>
      <textarea id="qaOutput" class="tool-output" placeholder="Answer appears here…"></textarea>
    </div>

    <div class="tool-card">
      <h3>Resume Polisher</h3>
      <p>Turn rough text into strong, concise resume bullets (US style).</p>
      <textarea id="resumeInput" class="tool-input" placeholder="Job experience…"></textarea>
      <button class="btn-primary" data-tool="resume">Polish</button>
      <textarea id="resumeOutput" class="tool-output" placeholder="Improved resume bullet(s)…"></textarea>
    </div>

  </div>
</section>

<!-- 本地工具 ---------------------------------------------------------->
<section>
  <h2 style="max-width:1080px;margin:0 auto 0;font-size:18px;">Quick Local Tools</h2>

  <div class="tools-grid">
    <div class="tool-card">
      <h3>Case Converter</h3>
      <p>UPPERCASE or Title Case.</p>
      <textarea id="caseInput" class="tool-input"></textarea>
      <button class="btn-secondary" id="btnUpper">UPPERCASE</button>
      <button class="btn-secondary" id="btnTitle">Title Case</button>
      <textarea id="caseOutput" class="tool-output"></textarea>
    </div>
  </div>
</section>

<footer style="text-align:center;padding:20px 0;font-size:14px;">
  © 2025 RootBro — support@rootbro.com
</footer>

<!-- Loading Modal ----------------------------------------------------->
<div id="loadingModal">
  <div class="modal-box">
    <h2>Preparing AI Model…</h2>
    <p>
      The lightweight Phi model (~25MB) is being downloaded and optimized.<br>
      This only happens once. Afterwards, tools run instantly — even offline.
    </p>
    <div class="progress-bar">
      <div class="progress-bar-inner" id="progressInner"></div>
    </div>
    <div style="font-size:12px;color:#666;margin-top:6px;">
      This may take 10–25 seconds depending on your device.
    </div>
  </div>
</div>


<!-- WebLLM + Phi Integration -------------------------------------------------->
<script type="module">
import { CreateMLCEngine } from "https://esm.run/@mlc-ai/web-llm";

/* 使用的 Phi 模型 ID */
const MODEL_ID = "Phi-3-mini-4k-instruct-q4f16_1-MLC";

let engine = null;
let initPromise = null;

const statusText = document.querySelector(".engine-status .progress");
const modal = document.getElementById("loadingModal");
const progressInner = document.getElementById("progressInner");

/* 显示 / 隐藏 Modal（白底提示框） */
function showModal() {
  if (modal) modal.style.display = "flex";
}
function hideModal() {
  if (modal) modal.style.display = "none";
}

/* 是否已经成功加载过模型（仅用于文案提示，不再控制 Modal 行为） */
const wasCached = localStorage.getItem("rootbro_phi_cached") === "1";
if (wasCached && statusText) {
  statusText.textContent = "Cached locally — ready";
}

/* 初始化引擎：仅在第一次真正需要时触发 */
async function getEngine() {
  if (engine) return engine;

  if (!initPromise) {
    // 用户第一次点 AI 功能 -> 这里才弹出提示 + 进度
    showModal();
    if (statusText) statusText.textContent = "Loading model…";

    initPromise = (async () => {
      try {
        const eng = await CreateMLCEngine(MODEL_ID, {
          initProgressCallback: (report) => {
            if (report && typeof report.progress === "number") {
              const pct = Math.round(report.progress * 100);
              if (progressInner) progressInner.style.width = pct + "%";
              if (statusText) {
                statusText.textContent = pct >= 100
                  ? "Model ready"
                  : `Loading… ${pct}%`;
              }
            }
            if (report && report.text && statusText) {
              statusText.textContent = report.text;
            }
          }
        });

        // 标记“已经成功加载过一次”，下次只是文案提示
        localStorage.setItem("rootbro_phi_cached", "1");
        hideModal();
        if (statusText) statusText.textContent = "Ready";
        return eng;
      } catch (err) {
        console.error("Engine init failed:", err);
        hideModal();
        if (statusText) statusText.textContent = "Error loading model";
        alert("Your browser may not support WebGPU or model loading failed.");
        throw err;
      }
    })();
  }

  engine = await initPromise;
  return engine;
}

/* 各工具的 system prompt */
function buildPrompt(kind) {
  switch (kind) {
    case "summarize":
      return "Summarize the text into short, clear bullet points or a concise paragraph. Keep the same language.";
    case "paraphrase":
      return "Rewrite the text to be clearer, more natural, and easier to read. Keep the meaning.";
    case "translate":
      return "Translate between English and Simplified Chinese automatically. Return only the translation.";
    case "explain":
      return "Explain the text in simpler language. Use short sentences.";
    case "qa":
      return "Answer the question based on the provided text. Be brief and direct.";
    case "resume":
      return "Rewrite the content into strong, concise American-style resume bullet points using action verbs.";
    default:
      return "You are a helpful writing assistant.";
  }
}

/* 统一 AI 执行入口：在这里才触发 getEngine() */
async function runTool(kind) {
  let inputEl, outputEl;

  switch (kind) {
    case "summarize":
      inputEl = sumInput; outputEl = sumOutput; break;
    case "paraphrase":
      inputEl = paraInput; outputEl = paraOutput; break;
    case "translate":
      inputEl = transInput; outputEl = transOutput; break;
    case "explain":
      inputEl = explainInput; outputEl = explainOutput; break;
    case "qa":
      inputEl = qaInput; outputEl = qaOutput; break;
    case "resume":
      inputEl = resumeInput; outputEl = resumeOutput; break;
    default:
      return;
  }

  const text = (inputEl?.value || "").trim();
  if (!text) {
    alert("Please enter some text first.");
    return;
  }

  const clipped = text.length > 2000 ? text.slice(0, 2000) : text;

  try {
    if (statusText) statusText.textContent = "Thinking…";
    if (outputEl) outputEl.value = "Thinking…";

    const eng = await getEngine();

    const reply = await eng.chat.completions.create({
      messages: [
        { role: "system", content: buildPrompt(kind) },
        { role: "user", content: clipped }
      ],
      temperature: 0.7
    });

    const content = reply.choices?.[0]?.message?.content || "(No output)";
    if (outputEl) outputEl.value = content.trim();
    if (statusText) statusText.textContent = "Ready";
  } catch (err) {
    console.error(err);
    if (outputEl) outputEl.value = "Error running local model. Check console.";
  }
}

/* 绑定所有 AI 按钮 */
document.querySelectorAll("button[data-tool]").forEach(btn => {
  btn.addEventListener("click", () => {
    const kind = btn.getAttribute("data-tool");
    runTool(kind);
  });
});

/* 本地 Case Converter */
btnUpper.addEventListener("click", () => {
  caseOutput.value = caseInput.value.toUpperCase();
});
btnTitle.addEventListener("click", () => {
  caseOutput.value = caseInput.value.replace(/\w\S*/g, w =>
    w.charAt(0).toUpperCase() + w.slice(1).toLowerCase()
  );
});

/* Tooltip 提示 */
const tip = document.getElementById("infoTip");
const tipBox = document.getElementById("tipBox");

if (tip && tipBox) {
  tip.addEventListener("mouseenter", () => {
    const rect = tip.getBoundingClientRect();
    tipBox.style.left = (rect.left - 220) + "px";
    tipBox.style.top = (rect.bottom + 6) + "px";
    tipBox.style.display = "block";
  });
  tip.addEventListener("mouseleave", () => {
    tipBox.style.display = "none";
  });
}
</script>

</body>
</html>
